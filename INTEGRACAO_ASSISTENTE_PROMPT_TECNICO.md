# üîó INTEGRA√á√ÉO: Assistente Inteligente + Novo Prompt T√©cnico ETP

## üìÖ Data: 04/08/2025
## üéØ Vers√£o: 1.0.0 - Integra√ß√£o Completa

---

## üéØ **OBJETIVO DA INTEGRA√á√ÉO**

Integrar o **Assistente Inteligente ETP** com o **Novo Prompt T√©cnico** baseado no Manual TRT-2, criando um sistema coeso que:

- ‚úÖ **Valida campos** conforme estrutura t√©cnica obrigat√≥ria
- ‚úÖ **Orienta preenchimento** baseado nas 17 se√ß√µes do Manual TRT-2
- ‚úÖ **Garante conformidade** com Lei 14.133/2021
- ‚úÖ **Melhora qualidade** dos ETPs gerados

---

## üîÑ **PONTOS DE INTEGRA√á√ÉO**

### **1. Mapeamento Campo ‚Üí Se√ß√£o TRT-2**

| Campo do Formul√°rio | Se√ß√£o Manual TRT-2 | Prompt Especializado |
|---------------------|---------------------|---------------------|
| `descricao_problema` | **1. Descri√ß√£o da Necessidade** | ‚úÖ `descricao_necessidade` |
| `solucoes_mercado` | **3. Solu√ß√µes Existentes no Mercado** | ‚úÖ `solucoes_mercado` |
| `solucao_proposta` | **7. Defini√ß√£o do Objeto** | ‚úÖ `definicao_objeto` |
| `justificativa_escolha` | **8. Justificativa de Escolha** | ‚úÖ `justificativa_escolha` |
| `valor_estimado` | **6. Estimativa do Valor** | ‚úÖ `estimativa_valor` |
| `cronograma` | **10. Estimativa de Quantidades** | ‚úÖ `estimativa_quantidades` |
| `estrategia_implantacao` | **14. Estrat√©gia de Implanta√ß√£o** | ‚ö†Ô∏è Gen√©rico |
| `beneficios` | **15. Benef√≠cios Esperados** | ‚ö†Ô∏è Gen√©rico |

### **2. Campos Ausentes no Formul√°rio**

**Se√ß√µes do Manual TRT-2 n√£o cobertas pelo formul√°rio atual:**
- **2. Hist√≥rico de Contrata√ß√µes** ‚Üí Prompt: `historico`
- **4. An√°lise de Riscos** ‚Üí Prompt: `analise_riscos`
- **5. Crit√©rios de Sustentabilidade** ‚Üí Prompt: `criterios_sustentabilidade`
- **11. Justificativa de Parcelamento** ‚Üí Prompt: `justificativa_parcelamento`
- **12. Depend√™ncia do Contratado** ‚Üí Prompt: `dependencia_contratado`
- **13. Transi√ß√£o Contratual** ‚Üí Prompt: `transicao_contratual`

---

## üîß **IMPLEMENTA√á√ÉO DA INTEGRA√á√ÉO**

### **Fase 1: Ajustar Prompts Especializados**

Os prompts especializados j√° est√£o alinhados com o Manual TRT-2. Vou criar um m√©todo para mapear campos do formul√°rio para se√ß√µes t√©cnicas:

```python
def _mapear_campo_para_secao_trt2(self, nome_campo: str) -> Dict[str, str]:
    """Mapeia campos do formul√°rio para se√ß√µes do Manual TRT-2."""
    mapeamento = {
        "descricao_problema": {
            "secao_trt2": "1. DESCRI√á√ÉO DA NECESSIDADE",
            "prompt_especializado": "descricao_necessidade",
            "criterios_obrigatorios": [
                "Conformidade com Decreto 9.507/2018",
                "Justificativa para terceiriza√ß√£o",
                "Identifica√ß√£o de terceiriza√ß√£o l√≠cita/il√≠cita",
                "Linguagem t√©cnica formal"
            ]
        },
        "solucoes_mercado": {
            "secao_trt2": "3. SOLU√á√ïES EXISTENTES NO MERCADO",
            "prompt_especializado": "solucoes_mercado",
            "criterios_obrigatorios": [
                "Pesquisa abrangente de alternativas",
                "An√°lise comparativa t√©cnica e econ√¥mica",
                "Considera√ß√£o de execu√ß√£o direta",
                "Vantagens e desvantagens fundamentadas"
            ]
        },
        "solucao_proposta": {
            "secao_trt2": "7. DEFINI√á√ÉO DO OBJETO",
            "prompt_especializado": "definicao_objeto",
            "criterios_obrigatorios": [
                "Descri√ß√£o t√©cnica precisa",
                "Especifica√ß√µes detalhadas",
                "Alinhamento com necessidade",
                "Possibilidade de m√∫ltiplos TRs"
            ]
        },
        "justificativa_escolha": {
            "secao_trt2": "8. JUSTIFICATIVA DE ESCOLHA DA SOLU√á√ÉO",
            "prompt_especializado": "justificativa_escolha",
            "criterios_obrigatorios": [
                "Fundamenta√ß√£o t√©cnica/operacional/financeira",
                "Demonstra√ß√£o de vantajosidade",
                "Compara√ß√£o com alternativas",
                "Alinhamento com interesse p√∫blico"
            ]
        }
    }
    
    return mapeamento.get(nome_campo, {
        "secao_trt2": "Se√ß√£o Gen√©rica",
        "prompt_especializado": "generico",
        "criterios_obrigatorios": ["An√°lise geral de qualidade"]
    })
```

### **Fase 2: Melhorar Feedback Contextual**

Vou aprimorar o m√©todo de an√°lise para incluir refer√™ncia √† se√ß√£o do Manual TRT-2:

```python
def analisar_campo_com_contexto_trt2(self, nome_campo: str, conteudo_atual: str, 
                                    contexto_anterior: Dict[str, Any]) -> Dict[str, Any]:
    """
    Analisa campo considerando contexto TRT-2 e integra√ß√£o com novo prompt.
    """
    # Obter mapeamento para se√ß√£o TRT-2
    mapeamento = self._mapear_campo_para_secao_trt2(nome_campo)
    
    # An√°lise normal do campo
    resultado = self.analisar_campo(nome_campo, conteudo_atual, contexto_anterior)
    
    # Adicionar contexto TRT-2
    if "erro" not in resultado:
        resultado["secao_trt2"] = mapeamento["secao_trt2"]
        resultado["criterios_obrigatorios"] = mapeamento["criterios_obrigatorios"]
        resultado["conformidade_manual"] = self._avaliar_conformidade_manual(
            conteudo_atual, mapeamento["criterios_obrigatorios"]
        )
    
    return resultado
```

### **Fase 3: Valida√ß√£o de Consist√™ncia com Novo Prompt**

Vou criar um m√©todo que valida se o conte√∫do dos campos est√° alinhado com a estrutura do novo prompt t√©cnico:

```python
def validar_alinhamento_prompt_tecnico(self, dados_etp: Dict[str, Any]) -> Dict[str, Any]:
    """
    Valida se os dados est√£o alinhados com a estrutura do novo prompt t√©cnico.
    """
    validacoes = []
    
    # Verificar campos obrigat√≥rios para cada se√ß√£o TRT-2
    secoes_obrigatorias = {
        "1. DESCRI√á√ÉO DA NECESSIDADE": dados_etp.get('descricao_problema'),
        "3. SOLU√á√ïES EXISTENTES NO MERCADO": dados_etp.get('solucoes_mercado'),
        "7. DEFINI√á√ÉO DO OBJETO": dados_etp.get('solucao_proposta'),
        "8. JUSTIFICATIVA DE ESCOLHA": dados_etp.get('justificativa_escolha'),
        "14. ESTRAT√âGIA DE IMPLANTA√á√ÉO": dados_etp.get('estrategia_implantacao'),
        "15. BENEF√çCIOS ESPERADOS": dados_etp.get('beneficios')
    }
    
    for secao, conteudo in secoes_obrigatorias.items():
        if not conteudo or not conteudo.strip():
            validacoes.append(f"‚ö†Ô∏è Se√ß√£o '{secao}' n√£o preenchida adequadamente")
        elif len(conteudo.strip()) < 50:
            validacoes.append(f"‚ö†Ô∏è Se√ß√£o '{secao}' precisa de mais detalhamento")
    
    # Verificar coer√™ncia entre se√ß√µes
    coerencia = self._verificar_coerencia_secoes(dados_etp)
    validacoes.extend(coerencia)
    
    return {
        "validacoes": validacoes,
        "status": "aprovado" if len(validacoes) == 0 else "requer_ajustes",
        "conformidade_trt2": len(validacoes) == 0
    }
```

---

## üé® **MELHORIAS NA INTERFACE**

### **1. Indicadores de Conformidade TRT-2**

Vou adicionar indicadores visuais que mostram a conformidade com o Manual TRT-2:

```python
def exibir_feedback_campo_com_trt2(feedback_resultado: Dict[str, Any]) -> None:
    """
    Exibe feedback incluindo conformidade com Manual TRT-2.
    """
    if "erro" in feedback_resultado:
        st.error(f"‚ùå {feedback_resultado['erro']}")
        return
    
    # Indicador de qualidade + conformidade TRT-2
    qualidade = feedback_resultado.get("qualidade", "regular")
    conformidade = feedback_resultado.get("conformidade_manual", False)
    
    # T√≠tulo com indicadores
    titulo = f"### {cores_qualidade.get(qualidade, 'üü°')} An√°lise do Campo"
    if conformidade:
        titulo += " ‚úÖ Conforme TRT-2"
    else:
        titulo += " ‚ö†Ô∏è Requer Adequa√ß√£o TRT-2"
    
    st.markdown(titulo)
    
    # Se√ß√£o TRT-2 correspondente
    if feedback_resultado.get("secao_trt2"):
        st.info(f"üìã **Se√ß√£o Manual TRT-2:** {feedback_resultado['secao_trt2']}")
    
    # Crit√©rios obrigat√≥rios
    if feedback_resultado.get("criterios_obrigatorios"):
        with st.expander("üìã Crit√©rios Obrigat√≥rios (Manual TRT-2)", expanded=False):
            for criterio in feedback_resultado["criterios_obrigatorios"]:
                st.markdown(f"‚Ä¢ {criterio}")
    
    # Feedback normal
    # ... resto do c√≥digo de exibi√ß√£o
```

### **2. Bot√£o de Valida√ß√£o Completa TRT-2**

Vou adicionar um bot√£o que valida todo o ETP contra a estrutura do Manual TRT-2:

```python
def criar_validacao_completa_trt2(dados_etp: Dict[str, Any], assistente: AssistenteEtpInteligente) -> None:
    """
    Cria interface para valida√ß√£o completa contra Manual TRT-2.
    """
    st.markdown("---")
    st.markdown("### üèõÔ∏è Valida√ß√£o Manual TRT-2")
    
    col1, col2 = st.columns(2)
    
    with col1:
        if st.button("üìã Validar Conformidade TRT-2", help="Verifica conformidade com todas as se√ß√µes obrigat√≥rias"):
            with st.spinner("Validando conformidade com Manual TRT-2..."):
                validacao = assistente.validar_alinhamento_prompt_tecnico(dados_etp)
                
                if validacao["status"] == "aprovado":
                    st.success("‚úÖ ETP conforme com Manual TRT-2!")
                else:
                    st.warning("‚ö†Ô∏è ETP requer ajustes para conformidade:")
                    for validacao_item in validacao["validacoes"]:
                        st.markdown(f"‚Ä¢ {validacao_item}")
    
    with col2:
        if st.button("üîç An√°lise Detalhada TRT-2", help="An√°lise detalhada de cada se√ß√£o"):
            st.info("Funcionalidade em desenvolvimento - an√°lise se√ß√£o por se√ß√£o")
```

---

## üìä **RESULTADOS ESPERADOS DA INTEGRA√á√ÉO**

### **Para o Usu√°rio:**
- ‚úÖ **Orienta√ß√£o Espec√≠fica**: Sabe exatamente qual se√ß√£o TRT-2 est√° preenchendo
- ‚úÖ **Crit√©rios Claros**: Conhece os crit√©rios obrigat√≥rios de cada se√ß√£o
- ‚úÖ **Valida√ß√£o T√©cnica**: Feedback baseado em normas oficiais
- ‚úÖ **Aprendizado Estruturado**: Aprende a estrutura correta dos ETPs

### **Para o Sistema:**
- ‚úÖ **Coer√™ncia Total**: Assistente e prompt trabalham em harmonia
- ‚úÖ **Qualidade Superior**: ETPs tecnicamente robustos
- ‚úÖ **Conformidade Garantida**: Ader√™ncia total ao Manual TRT-2
- ‚úÖ **Redu√ß√£o de Erros**: Menos retrabalho e questionamentos

### **Para a Organiza√ß√£o:**
- ‚úÖ **Padroniza√ß√£o**: Todos os ETPs seguem a mesma estrutura t√©cnica
- ‚úÖ **Efici√™ncia**: Processo mais r√°pido e confi√°vel
- ‚úÖ **Conformidade Legal**: Redu√ß√£o de riscos regulat√≥rios
- ‚úÖ **Capacita√ß√£o**: Equipe aprende as melhores pr√°ticas

---

## üîß **IMPLEMENTA√á√ÉO T√âCNICA**

### **Arquitetura Integrada:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    SISTEMA INTEGRADO                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  FORMUL√ÅRIO STREAMLIT                                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Campo 1 ‚Üí Assistente ‚Üí Valida√ß√£o TRT-2 ‚Üí Feedback     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Campo 2 ‚Üí Assistente ‚Üí Valida√ß√£o TRT-2 ‚Üí Feedback     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Campo N ‚Üí Assistente ‚Üí Valida√ß√£o TRT-2 ‚Üí Feedback     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  VALIDA√á√ÉO GERAL                                            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Consist√™ncia entre campos                             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Conformidade Manual TRT-2                             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Alinhamento com Novo Prompt                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  GERA√á√ÉO DO ETP                                             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Novo Prompt T√©cnico (17 se√ß√µes)                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Dados validados pelo Assistente                       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Documento conforme Manual TRT-2                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Fluxo de Integra√ß√£o:**

1. **Preenchimento do Campo** ‚Üí Usu√°rio digita conte√∫do
2. **An√°lise Contextual** ‚Üí Assistente analisa com prompt especializado
3. **Valida√ß√£o TRT-2** ‚Üí Verifica conformidade com se√ß√£o espec√≠fica
4. **Feedback Integrado** ‚Üí Mostra qualidade + conformidade
5. **Valida√ß√£o Geral** ‚Üí Verifica consist√™ncia global
6. **Gera√ß√£o T√©cnica** ‚Üí Novo prompt cria ETP conforme Manual TRT-2

---

## ‚úÖ **STATUS DA INTEGRA√á√ÉO**

**INTEGRA√á√ÉO CONCEITUAL: ESPECIFICADA E PRONTA PARA IMPLEMENTA√á√ÉO** üéâ

A integra√ß√£o entre o Assistente Inteligente e o Novo Prompt T√©cnico est√° completamente especificada. A implementa√ß√£o criar√° um sistema coeso que garante ETPs de alta qualidade t√©cnica e total conformidade com o Manual TRT-2.

**Pr√≥ximo Passo:** Implementar os m√©todos de integra√ß√£o no c√≥digo.